{% extends "flask_user_layout.html" %}
{% block content %}
<div class="container">
    <h2>Recommender</h2>
</div>
<div><b>Q. Which Genres do you like most? Only 3 Genres will be considered. </b></div>
<div><b>Make sure you save your answer, before you click on "Next"! </b></div>

<div class="genre-picker-container">
    <iframe name="form-void" style="display:none;"></iframe>
    <form class="genre-picker" target="form-void" onsubmit="getRecommendations()">
        {% for genre in genres %}
        <label>
            <input type="checkbox" name="{{ genre }}"> {{genre}}
        </label>
        {% endfor %}
    </form>
</div>

<form action="/movies" method="GET" class="box">
    <input type="submit" class="btn btn-default btn-primary" value="{%trans%}Save{%endtrans%}" name="checked_boxes">
    <button type="submit" class="btn btn-default btn-primary" >Next</button>
</form>
    

{% endblock %}

{% block extra_js %}
<script>
    const checkboxes = document.querySelectorAll(".genre-picker>label>input");
    $("input[type='submit']").click(submitGenres);

    function submitGenres(e) {
        e.preventDefault();
        var checked = [];
        for (var cb of checkboxes) {
            if (cb.checked) {
                checked.push(cb.name);
            }
        }

        if (!checked.length) {
            alert("Please select at least one genre.");
            return;
        }

        //alert(checked);


        // Create an AJAX request
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/recommender', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        // Handle the response
        xhr.onload = function () {
            if (xhr.status === 200) {
                // Replace the entire div with the response
                elem.parentElement.innerHTML = xhr.responseText;
            } else {
                alert('Request failed. Returned status of ' + xhr.status);
            }
        };

        // Send the request with the movie ID and the rating
        xhr.send('checked=' + checked );
        
    }
</script>
{% endblock %}

